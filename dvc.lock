schema: '2.0'
stages:
  pull_data_calibrated:
    cmd: python src/pull_data.py pull_data_calibrated data/db_pull_calibrated.parquet
    deps:
    - path: src/pull_data.py
      md5: 1a42c5257353dba8807288bf70df52d5
      size: 1350
    - path: src/utils/dbconnector.py
      md5: b7188e7cd2f1bbd97582ac4344a12c2b
      size: 1445
    params:
      params.yaml:
        pull_data_calibrated:
          database:
            questdb:
              table_name: prod
              host: docker.great-squeaker.ts.net
              port: 9000
          get_calibrated: true
    outs:
    - path: data/db_pull_calibrated.parquet
      md5: d30e256f1a00d82ece6f07422261055a
      size: 135521717
  resample_50Hz:
    cmd: python src/resample.py resample_50Hz data/db_pull_calibrated.parquet data/resample_50Hz.parquet
    deps:
    - path: data/db_pull_calibrated.parquet
      md5: d30e256f1a00d82ece6f07422261055a
      size: 135521717
    - path: src/resample.py
      md5: 0da3e6b41da594c64b671cb6d2694c50
      size: 1315
    params:
      params.yaml:
        resample_50Hz:
          resample_frequency_hz: 50
          interpolation_method: linear
    outs:
    - path: data/resample_50Hz.parquet
      md5: 816b70cbdfd4208db96e8525156c821f
      size: 88337427
  segmentate_5s:
    cmd: python src/segmentate.py segmentate_5s data/resample_50Hz.parquet data/segmentate_5s.dill
    deps:
    - path: data/resample_50Hz.parquet
      md5: 816b70cbdfd4208db96e8525156c821f
      size: 88337427
    - path: src/segmentate.py
      md5: 88b4c1ea896ec9e7f13a795d6f2fb9a7
      size: 2543
    params:
      params.yaml:
        segmentate_5s:
          window_len_s: 5
          overlap_percent: 0
    outs:
    - path: data/segmentate_5s.dill
      md5: 0095ea796c2877fccd2d2f63f8227bcc
      size: 128345824
  filter_highpass_ord3_cut01:
    cmd: python src/butterworth_filter.py filter_highpass_ord3_cut01 data/segmentate_5s.dill
      data/highpass_ord3_cut01.dill
    deps:
    - path: data/segmentate_5s.dill
      md5: 0095ea796c2877fccd2d2f63f8227bcc
      size: 128345824
    - path: src/butterworth_filter.py
      md5: 8e474d21e9a43e5b53f60f582fb99bed
      size: 1205
    - path: src/utils/filters.py
      md5: b1f713bc69905681c28421fee8996207
      size: 1897
    params:
      params.yaml:
        filter_highpass_ord3_cut01:
          filter_type: highpass
          order: 3
          cutoff_f_Hz: 0.1
    outs:
    - path: data/highpass_ord3_cut01.dill
      md5: 64e70eedc01e65547724b26176275a8f
      size: 210021628
  transform_min_max:
    cmd: python src/transform.py transform_min_max data/segmentate_5s.dill data/train_test_split_ratio02.json
      data/segments_min_max.dill data/transformer_min_max.dill
    deps:
    - path: data/segmentate_5s.dill
      md5: 0095ea796c2877fccd2d2f63f8227bcc
      size: 128345824
    - path: src/transform.py
      md5: 04430ea0bedc237386f5d96a06bbd1b4
      size: 6497
    - path: src/utils/transformers.py
      md5: acc88e39d924f0a986e4c6468bbaa759
      size: 6162
    params:
      params.yaml:
        transform_min_max:
          transformation: min-max
          transformation_params:
            feature_range_min: 0
            feature_range_max: 1
    outs:
    - path: data/segments_min_max.dill
      md5: 46276f60d712c4acaa8e0a602ac542a9
      size: 133037488
    - path: data/transformer_min_max.dill
      md5: e2b1c5acf34781191f4cc50d8348b9d3
      size: 1366
  train_test_split_ratio02:
    cmd: python src/train_test_split.py train_test_split_ratio02 data/segmentate_5s.dill
      data/train_test_split_ratio02.json
    deps:
    - path: data/segmentate_5s.dill
      md5: 0095ea796c2877fccd2d2f63f8227bcc
      size: 128345824
    - path: src/train_test_split.py
      md5: b94aa69d867a09dfb041010bc043dda8
      size: 2650
    params:
      params.yaml:
        train_test_split_ratio02:
          type: person
          test_ratio: 0.2
          seed: 9458
          stratified: true
    outs:
    - path: data/train_test_split_ratio02.json
      md5: 20a5446519af97f135682be727731a9f
      size: 49755
  fft:
    cmd: python src/fft.py fft data/segmentate_5s.dill data/fft.dill
    deps:
    - path: data/segmentate_5s.dill
      md5: 0095ea796c2877fccd2d2f63f8227bcc
      size: 128345824
    - path: src/fft.py
      md5: 9db99a6af3ff1576c1f09b8a94d9bc87
      size: 2177
    outs:
    - path: data/fft.dill
      md5: c95b934d04e8f85163672fe5a7a12b68
      size: 58808547
  transform_standardize:
    cmd: python src/transform.py transform_standardize data/segmentate_5s.dill data/train_test_split_ratio02.json
      data/segments_standardized.dill data/transformer_standardize.dill
    deps:
    - path: data/segmentate_5s.dill
      md5: 0095ea796c2877fccd2d2f63f8227bcc
      size: 128345824
    - path: src/transform.py
      md5: 04430ea0bedc237386f5d96a06bbd1b4
      size: 6497
    - path: src/utils/transformers.py
      md5: acc88e39d924f0a986e4c6468bbaa759
      size: 6162
    params:
      params.yaml:
        transform_standardize:
          transformation: standardize
    outs:
    - path: data/segments_standardized.dill
      md5: 4b991fae3b280ac53df30bab9cba713e
      size: 133037488
    - path: data/transformer_standardize.dill
      md5: e4959de7e074095304300864c37223ca
      size: 1331
  moving_average_01s:
    cmd: python src/moving_average.py moving_average_01s data/segmentate_5s.dill data/moving_average_01s.dill
    deps:
    - path: data/segmentate_5s.dill
      md5: 0095ea796c2877fccd2d2f63f8227bcc
      size: 128345824
    - path: src/moving_average.py
      md5: c5124ab3ad46ccfef083c2b522638279
      size: 1593
    params:
      params.yaml:
        moving_average_01s:
          window_len_s: 0.1
    outs:
    - path: data/moving_average_01s.dill
      md5: 14c13f81438401957948ac355c107486
      size: 210057114
  correlations_pearson:
    cmd: python src/correlations.py correlations_pearson data/segmentate_5s.dill data/correlations_pearson.parquet
    deps:
    - path: data/segmentate_5s.dill
      md5: 0095ea796c2877fccd2d2f63f8227bcc
      size: 128345824
    - path: src/correlations.py
      md5: de117acfae881d935236b20cae0a0f9c
      size: 1994
    params:
      params.yaml:
        correlations_pearson:
          correlation_method: pearson
    outs:
    - path: data/correlations_pearson.parquet
      md5: a1e87229a3157e95095d925dec56928d
      size: 6067695
  dvclive:
    cmd: python src/model_runner.py dvclive data/correlations_pearson.parquet data/train_test_split_ratio02.json
      data/model.pkl data/output_test.csv
    deps:
    - path: data/correlations_pearson.parquet
      md5: a1e87229a3157e95095d925dec56928d
      size: 6067695
    - path: data/train_test_split_ratio02.json
      md5: 20a5446519af97f135682be727731a9f
      size: 49755
    - path: src/model_runner.py
      md5: 2abb254ae71201cbf475842f5df104e8
      size: 3810
    - path: src/models/MLP.py
      md5: 8b236f50b46b6385db26e8e434db95e3
      size: 1353
    - path: src/models/__IModel.py
      md5: a2a67fca041256c488b0480ca87afbe9
      size: 1819
    - path: src/models/utils/DataLoaderSklearn.py
      md5: af3e0b6410bc2993fa19350e206b4522
      size: 1624
    - path: src/models/utils/DataLoaderTabular.py
      md5: ccff705dbb7fd3667c865f8d9a40ea2f
      size: 3818
    - path: src/models/utils/DataSetTabular.py
      md5: fea93aac0c6f741cf12f95f82fa82eb7
      size: 330
    params:
      params.yaml:
        dvclive:
          model: HistGradientBoostingClassifier
          seed: 41
          data:
            type: Sklearn
          model_hparams:
            learning_rate: 0.2
            max_iter: 2000
            max_leaf_nodes: 31
            min_samples_leaf: 20
            max_bins: 255
    outs:
    - path: data/model.pkl
      md5: 44d501bd59e6393fb9f258b0c155d82b
      size: 4849746
    - path: data/output_test.csv
      md5: 31c549b1447fa4263195463d778e8737
      size: 5604
    - path: dvclive/metrics.json
      md5: d6a10a37b7e49eec3861c9844a5ae7ff
      size: 141
    - path: dvclive/plots
      md5: 1982e2e260f75b7d5a44643a3e6dbddd.dir
      size: 135
      nfiles: 4
  filter_bandpass_ord3_low01_high100:
    cmd: python src/butterworth_filter.py filter_bandpass_ord3_low01_high100 data/segmentate_5s.dill
      data/bandpass_ord3_low01_high100.dill
    deps:
    - path: data/segmentate_5s.dill
      md5: 0095ea796c2877fccd2d2f63f8227bcc
      size: 128345824
    - path: src/butterworth_filter.py
      md5: 8e474d21e9a43e5b53f60f582fb99bed
      size: 1205
    - path: src/utils/filters.py
      md5: b1f713bc69905681c28421fee8996207
      size: 1897
    params:
      params.yaml:
        filter_bandpass_ord3_low01_high100:
          filter_type: bandpass
          order: 3
          lowcut_f_Hz: 0.1
          highcut_f_Hz: 100
    outs:
    - path: data/bandpass_ord3_low01_high100.dill
      md5: 3d81899bec614428c49f0fa32a92e481
      size: 210021628
  aggregate_mean_median_std:
    cmd: python src/aggregate.py aggregate_mean_median_std data/segmentate_5s.dill
      data/aggregate_mean_median_std.dill
    deps:
    - path: data/segmentate_5s.dill
      md5: 0095ea796c2877fccd2d2f63f8227bcc
      size: 128345824
    - path: src/aggregate.py
      md5: 78df79f7383ef627c56b0b0a0561e652
      size: 1618
    params:
      params.yaml:
        aggregate_mean_median_std:
        - mean
        - median
        - std
    outs:
    - path: data/aggregate_mean_median_std.dill
      md5: 8ac4bb2ef904c64380b05669fe141ff9
      size: 5478173
  filter_lowpass_ord3_cut100:
    cmd: python src/butterworth_filter.py filter_lowpass_ord3_cut100 data/segmentate_5s.dill
      data/lowpass_ord3_cut100.dill
    deps:
    - path: data/segmentate_5s.dill
      md5: 0095ea796c2877fccd2d2f63f8227bcc
      size: 128345824
    - path: src/butterworth_filter.py
      md5: 8e474d21e9a43e5b53f60f582fb99bed
      size: 1205
    - path: src/utils/filters.py
      md5: b1f713bc69905681c28421fee8996207
      size: 1897
    params:
      params.yaml:
        filter_lowpass_ord3_cut100:
          filter_type: lowpass
          order: 3
          cutoff_f_Hz: 100
    outs:
    - path: data/lowpass_ord3_cut100.dill
      md5: ac4e1d5a4c477154cda4aa67365e0d79
      size: 210021628
  transform_pca:
    cmd: python src/transform.py transform_pca data/segmentate_5s.dill data/train_test_split_ratio02.json
      data/segments_pca.dill data/transformer_pca.dill
    deps:
    - path: data/segmentate_5s.dill
      md5: 0095ea796c2877fccd2d2f63f8227bcc
      size: 128345824
    - path: src/transform.py
      md5: 04430ea0bedc237386f5d96a06bbd1b4
      size: 6497
    - path: src/utils/transformers.py
      md5: acc88e39d924f0a986e4c6468bbaa759
      size: 6162
    params:
      params.yaml:
        transform_pca:
          transformation: pca
          transformation_params:
            n_components: 6
    outs:
    - path: data/segments_pca.dill
      md5: a08a9489ae815624df98f039a98f5d8f
      size: 106226311
    - path: data/transformer_pca.dill
      md5: aaeae3e3578b717b33827bf6434a45a5
      size: 1678
  evaluate:
    cmd: python src/evaluate.py evaluate data/output_test.csv evaluation/confusion_matrix.png
    deps:
    - path: data/output_test.csv
      md5: 31c549b1447fa4263195463d778e8737
      size: 5604
    - path: src/evaluate.py
      md5: dc1806850d7da42ff3015912d5828ac6
      size: 981
    outs:
    - path: evaluation/confusion_matrix.png
      md5: 341dea7c82f36237c36c9178afbe1d0f
      size: 42696
