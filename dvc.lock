schema: '2.0'
stages:
  pull_data_calibrated:
    cmd: python src/pull_data.py pull_data_calibrated data/db_pull_calibrated.parquet
    deps:
    - path: src/pull_data.py
      md5: 7a6ab7c7508987056a69512c01b2e036
      size: 1487
    - path: src/utils/dbconnector.py
      md5: 52b0248a2e4fddcdccde9ad54f2b804d
      size: 1503
    params:
      params.yaml:
        pull_data_calibrated:
          database:
            questdb:
              table_name: prod
              host: docker.great-squeaker.ts.net
              port: 9000
          get_calibrated: true
    outs:
    - path: data/db_pull_calibrated.parquet
      md5: d30e256f1a00d82ece6f07422261055a
      size: 135521717
  resample_50Hz:
    cmd: python src/resample.py resample_50Hz data/db_pull_calibrated.parquet data/resample_50Hz.parquet
    deps:
    - path: data/db_pull_calibrated.parquet
      md5: d30e256f1a00d82ece6f07422261055a
      size: 135521717
    - path: src/resample.py
      md5: 462a6b0ce71fa410caba2ed23903653b
      size: 1393
    params:
      params.yaml:
        resample_50Hz:
          resample_frequency_hz: 50
          interpolation_method: linear
    outs:
    - path: data/resample_50Hz.parquet
      md5: 1929d42b5a57c5d18837b3eb6bfa6131
      size: 88337427
  segmentate_5s:
    cmd: python src/segmentate.py segmentate_5s data/resample_50Hz.parquet data/segmentate_5s.dill
    deps:
    - path: data/resample_50Hz.parquet
      md5: 1929d42b5a57c5d18837b3eb6bfa6131
      size: 88337427
    - path: src/segmentate.py
      md5: 6142dcfc4005e3e863c44b79e2eca369
      size: 2642
    params:
      params.yaml:
        segmentate_5s:
          window_len_s: 5
          overlap_percent: 0
    outs:
    - path: data/segmentate_5s.dill
      md5: cb6f2552aead7773f1b38d2d67324acf
      size: 127847482
  moving_average_01s:
    cmd: python src/moving_average.py moving_average_01s data/segmentate_5s.dill data/moving_average_01s.dill
    deps:
    - path: data/segmentate_5s.dill
      md5: cb6f2552aead7773f1b38d2d67324acf
      size: 127847482
    - path: src/moving_average.py
      md5: 3352de5241f3bd0e5e2203e59ad6e763
      size: 1733
    params:
      params.yaml:
        moving_average_01s:
          window_len_s: 0.1
    outs:
    - path: data/moving_average_01s.dill
      md5: 68e103c7267ad7b251aa4ecdcc23473c
      size: 209254092
  filter_highpass_ord3_cut01:
    cmd: python src/butterworth_filter.py filter_highpass_ord3_cut01 data/segmentate_5s.dill
      data/highpass_ord3_cut01.dill
    deps:
    - path: data/segmentate_5s.dill
      md5: cb6f2552aead7773f1b38d2d67324acf
      size: 127847482
    - path: src/butterworth_filter.py
      md5: a6c92cddab64263aa72cabfbe167af10
      size: 1290
    - path: src/utils/filters.py
      md5: 52dd6a0052666f809f9bd984e0310f30
      size: 2053
    params:
      params.yaml:
        filter_highpass_ord3_cut01:
          filter_type: highpass
          order: 3
          cutoff_f_Hz: 1e-05
    outs:
    - path: data/highpass_ord3_cut01.dill
      md5: 633eeea45fd3b66d5cb3adb6fe3c8596
      size: 209218222
  train_test_split_ratio02:
    cmd: python src/train_test_split.py train_test_split_ratio02 data/segmentate_5s.dill
      data/train_test_split_ratio02.json
    deps:
    - path: data/segmentate_5s.dill
      md5: cb6f2552aead7773f1b38d2d67324acf
      size: 127847482
    - path: src/train_test_split.py
      md5: 86f3a77a5b038fe0824f7c2bd09ade01
      size: 2735
    params:
      params.yaml:
        train_test_split_ratio02:
          type: segment
          test_ratio: 0.2
          seed: 9458
          stratified: true
    outs:
    - path: data/train_test_split_ratio02.json
      md5: 1babc49cc8fcdded8c99ef9980407f17
      size: 49755
  transform_pca:
    cmd: python src/transform.py transform_pca data/segmentate_5s.dill data/train_test_split_ratio02.json
      data/segments_pca.dill data/transformer_pca.dill
    deps:
    - path: data/segmentate_5s.dill
      md5: cb6f2552aead7773f1b38d2d67324acf
      size: 127847482
    - path: data/train_test_split_ratio02.json
      md5: 1babc49cc8fcdded8c99ef9980407f17
      size: 49755
    - path: src/transform.py
      md5: f87ddb460eef3faeafb765c6c7bb8528
      size: 7245
    - path: src/utils/transformers.py
      md5: c290cd7fbd334c98aa0a0d2b64c0f557
      size: 6680
    params:
      params.yaml:
        transform_pca:
          transformation: pca
          transformation_params:
            n_components:
    outs:
    - path: data/segments_pca.dill
      md5: 56c0490a57ad60518eee654e67759a88
      size: 133017116
    - path: data/transformer_pca.dill
      md5: 8b458f8652ee6d857ff2bdd5d637501d
      size: 1820
  fft:
    cmd: python src/fft.py fft data/segmentate_5s.dill data/fft.dill
    deps:
    - path: data/segmentate_5s.dill
      md5: cb6f2552aead7773f1b38d2d67324acf
      size: 127847482
    - path: src/fft.py
      md5: afc75b2259d35fefa24612f94782dbdd
      size: 2350
    outs:
    - path: data/fft.dill
      md5: 92743b085a4232b05d4e04fe1a467bbe
      size: 67080904
  transform_min_max:
    cmd: python src/transform.py transform_min_max data/segmentate_5s.dill data/train_test_split_ratio02.json
      data/segments_min_max.dill data/transformer_min_max.dill
    deps:
    - path: data/segmentate_5s.dill
      md5: cb6f2552aead7773f1b38d2d67324acf
      size: 127847482
    - path: data/train_test_split_ratio02.json
      md5: 1babc49cc8fcdded8c99ef9980407f17
      size: 49755
    - path: src/transform.py
      md5: f87ddb460eef3faeafb765c6c7bb8528
      size: 7245
    - path: src/utils/transformers.py
      md5: c290cd7fbd334c98aa0a0d2b64c0f557
      size: 6680
    params:
      params.yaml:
        transform_min_max:
          transformation: min-max
          transformation_params:
            feature_range_min: 0
            feature_range_max: 1
    outs:
    - path: data/segments_min_max.dill
      md5: 76a6c38a4c91a5fbb9883f303516edb6
      size: 133017173
    - path: data/transformer_min_max.dill
      md5: 8051974b33ca9418b2a3c727238855c2
      size: 1366
  transform_standardize:
    cmd: python src/transform.py transform_standardize data/segmentate_5s.dill data/train_test_split_ratio02.json
      data/segments_standardized.dill data/transformer_standardize.dill
    deps:
    - path: data/segmentate_5s.dill
      md5: cb6f2552aead7773f1b38d2d67324acf
      size: 127847482
    - path: data/train_test_split_ratio02.json
      md5: 1babc49cc8fcdded8c99ef9980407f17
      size: 49755
    - path: src/transform.py
      md5: f87ddb460eef3faeafb765c6c7bb8528
      size: 7245
    - path: src/utils/transformers.py
      md5: c290cd7fbd334c98aa0a0d2b64c0f557
      size: 6680
    params:
      params.yaml:
        transform_standardize:
          transformation: standardize
    outs:
    - path: data/segments_standardized.dill
      md5: 9b2c63af4395a75635ca71c7225a41b5
      size: 133017173
    - path: data/transformer_standardize.dill
      md5: 4ef37b374addf2185c30bb76095a08c3
      size: 1331
  filter_lowpass_ord3_cut100:
    cmd: python src/butterworth_filter.py filter_lowpass_ord3_cut100 data/segmentate_5s.dill
      data/lowpass_ord3_cut100.dill
    deps:
    - path: data/segmentate_5s.dill
      md5: cb6f2552aead7773f1b38d2d67324acf
      size: 127847482
    - path: src/butterworth_filter.py
      md5: a6c92cddab64263aa72cabfbe167af10
      size: 1290
    - path: src/utils/filters.py
      md5: 52dd6a0052666f809f9bd984e0310f30
      size: 2053
    params:
      params.yaml:
        filter_lowpass_ord3_cut100:
          filter_type: lowpass
          order: 3
          cutoff_f_Hz: 100
    outs:
    - path: data/lowpass_ord3_cut100.dill
      md5: 9bfc8a8e9aa7e8abe723af4abe6b9842
      size: 209218222
  correlations_pearson:
    cmd: python src/correlations.py correlations_pearson data/segmentate_5s.dill data/correlations_pearson.parquet
    deps:
    - path: data/segmentate_5s.dill
      md5: cb6f2552aead7773f1b38d2d67324acf
      size: 127847482
    - path: src/correlations.py
      md5: 873dc9d29c91821565509bc9ccc1d548
      size: 3405
    params:
      params.yaml:
        correlations_pearson:
          correlation_method: pearson
    outs:
    - path: data/correlations_pearson.parquet
      md5: 2fd284e475e0dbe358934d631883f1e5
      size: 6067947
  aggregate_mean_median_std:
    cmd: python src/aggregate.py aggregate_mean_median_std data/segmentate_5s.dill
      data/aggregate_mean_median_std.dill
    deps:
    - path: data/segmentate_5s.dill
      md5: cb6f2552aead7773f1b38d2d67324acf
      size: 127847482
    - path: src/aggregate.py
      md5: 77a3f42689ecfc43df61714e2111b97e
      size: 1691
    params:
      params.yaml:
        aggregate_mean_median_std:
        - mean
        - median
        - std
    outs:
    - path: data/aggregate_mean_median_std.dill
      md5: fc6e0c123d45a875969918f911328670
      size: 5478173
  filter_bandpass_ord3_low01_high100:
    cmd: python src/butterworth_filter.py filter_bandpass_ord3_low01_high100 data/segmentate_5s.dill
      data/bandpass_ord3_low01_high100.dill
    deps:
    - path: data/segmentate_5s.dill
      md5: cb6f2552aead7773f1b38d2d67324acf
      size: 127847482
    - path: src/butterworth_filter.py
      md5: a6c92cddab64263aa72cabfbe167af10
      size: 1290
    - path: src/utils/filters.py
      md5: 52dd6a0052666f809f9bd984e0310f30
      size: 2053
    params:
      params.yaml:
        filter_bandpass_ord3_low01_high100:
          filter_type: bandpass
          order: 3
          lowcut_f_Hz: 1e-05
          highcut_f_Hz: 100
    outs:
    - path: data/bandpass_ord3_low01_high100.dill
      md5: f30019e8e906e463197df1724a1d2807
      size: 209218222
  stft:
    cmd: python src/stft.py stft data/segmentate_5s.dill data/stft.dill
    deps:
    - path: data/segmentate_5s.dill
      md5: cb6f2552aead7773f1b38d2d67324acf
      size: 127847482
    - path: src/stft.py
      md5: 94cffcec192b08ff1181648d159d321a
      size: 1222
    outs:
    - path: data/stft.dill
      md5: cce57c6e443b6d328dcb5ebc3177a071
      size: 794097681
  dvclive:
    cmd: python src/model_runner.py dvclive data/fft.dill data/train_test_split_ratio02.json
      data/model.pkl data/output_test.csv
    deps:
    - path: data/fft.dill
      md5: 92743b085a4232b05d4e04fe1a467bbe
      size: 67080904
    - path: data/train_test_split_ratio02.json
      md5: 1babc49cc8fcdded8c99ef9980407f17
      size: 49755
    - path: src/model_runner.py
      md5: 129d6161b5f601b3e71702e24267f321
      size: 4965
    - path: src/models/MLP.py
      md5: 8b236f50b46b6385db26e8e434db95e3
      size: 1395
    - path: src/models/__IModel.py
      md5: a2a67fca041256c488b0480ca87afbe9
      size: 1878
    - path: src/models/utils/DataLoaderSklearn.py
      md5: c9ac5d9223ea82eba03e2ff2f2746044
      size: 4015
    - path: src/models/utils/DataLoaderTabular.py
      md5: ca4642b7b1aa7ee18344d1a2f35b4066
      size: 1894
    - path: src/models/utils/DataSetTabular.py
      md5: fea93aac0c6f741cf12f95f82fa82eb7
      size: 347
    params:
      params.yaml:
        dvclive:
          model: HistGradientBoostingClassifier
          seed: 41
          data:
            type: Sklearn_Segments
            params:
              columns: numeric
          model_hparams:
            learning_rate: 0.2
            max_iter: 2000
            max_leaf_nodes: 31
            min_samples_leaf: 20
            max_bins: 255
    outs:
    - path: data/model.pkl
      md5: 54e2570543e2c6c2020d6f218e2c76e4
      size: 5440802
    - path: data/output_test.csv
      md5: c9a22b0d2a1bfdc4e7f2da72e7591563
      size: 8500
    - path: dvclive/metrics.json
      md5: c6043ee3fd670714da7a608214169c16
      size: 145
    - path: dvclive/plots
      md5: d7440eb7bd03af4841ed706e85562bcf.dir
      size: 142
      nfiles: 4
  evaluate:
    cmd: python src/evaluate.py evaluate data/output_test.csv evaluation/confusion_matrix.png
    deps:
    - path: data/output_test.csv
      md5: c9a22b0d2a1bfdc4e7f2da72e7591563
      size: 8500
    - path: src/evaluate.py
      md5: 1d1a8fa2598be16d9b78212e528e284f
      size: 1021
    outs:
    - path: evaluation/confusion_matrix.png
      md5: 5d6d131b64afc6c5bc67c1441dbb8225
      size: 39883
